<div class="header">
  <button mat-flat-button class="btn-new-task">New task</button>
  <button mat-fab extended>
    <mat-icon>search</mat-icon>
    Search
  </button>

  <button mat-fab extended>
    <mat-icon>person</mat-icon>
    Person
  </button>

  <button mat-fab extended>
    <mat-icon>sort</mat-icon>
    Sort
  </button>
</div>

<div class="table-container">
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="$event ? toggleAllRows() : null"
          [checked]="selection.hasValue() && isAllSelected()"
          [indeterminate]="selection.hasValue() && !isAllSelected()"
        >
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation()"
          (change)="$event ? toggleRowSelection(row) : null"
          [checked]="selection.isSelected(row)"
        >
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- Task Column -->
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef>Task</th>
      <td mat-cell *matCellDef="let element">
        <input
          *ngIf="element.isEditMode"
          matInput
          [(ngModel)]="element.title"
          placeholder="Enter Task"
        />
        <span *ngIf="!element.isEditMode">{{ element.title }}</span>
      </td>
    </ng-container>

    <!-- Developer Column -->
    <ng-container matColumnDef="developer">
      <th mat-header-cell *matHeaderCellDef>Developer</th>
      <td mat-cell *matCellDef="let element">
        <mat-select
          *ngIf="element.isEditMode"
          [(ngModel)]="element.developers"
          (ngModelChange)="updateDeveloper(element, $event)"
          multiple
          placeholder="Select Developer"
        >
          <mat-option *ngFor="let dev of developers" [value]="dev">
            {{ dev }}
          </mat-option>
        </mat-select>

        <span *ngIf="!element.isEditMode">{{ element.developer }}</span>
      </td>
    </ng-container>

    <!-- Priority Column -->
    <ng-container matColumnDef="priority">
      <th mat-header-cell *matHeaderCellDef>Priority</th>
      <td mat-cell *matCellDef="let row">
        <mat-select *ngIf="row.isEditMode" [(ngModel)]="row.priority">
          <mat-option
            *ngFor="let option of priorityOptions"
            [value]="option"
            [ngClass]="getPriorityClass(option)"
          >
            {{ option }}
          </mat-option>
        </mat-select>

        <span
          *ngIf="!row.isEditMode"
          class="priority-badge"
          [ngClass]="getPriorityClass(row.priority)"
        >
          {{ row.priority }}
        </span>
      </td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let row">
        <mat-select *ngIf="row.isEditMode" [(ngModel)]="row.status">
          <mat-option
            *ngFor="let option of statusOptions"
            [value]="option"
            [ngClass]="getStatusClass(option)"
          >
            {{ option }}
          </mat-option>
        </mat-select>

        <span
          *ngIf="!row.isEditMode"
          class="status-badge"
          [ngClass]="getStatusClass(row.status)"
        >
          {{ row.status }}
        </span>
      </td>
    </ng-container>

    <!-- Type Column -->
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Type</th>
      <td mat-cell *matCellDef="let row">
        <mat-select *ngIf="row.isEditMode" [(ngModel)]="row.type">
          <mat-option
            *ngFor="let option of typeOptions"
            [value]="option"
            [ngClass]="getTypeClass(option)"
          >
            {{ option }}
          </mat-option>
        </mat-select>
        <span
          *ngIf="!row.isEditMode"
          class="type-badge"
          [ngClass]="getTypeClass(row.type)"
        >
          {{ row.type }}
        </span>
      </td>
    </ng-container>

    <!-- Estimated SP Column -->
    <ng-container matColumnDef="Estimated SP">
      <th mat-header-cell *matHeaderCellDef>Estimated SP</th>
      <td mat-cell *matCellDef="let element">
        <input
          *ngIf="element.isEditMode"
          type="number"
          [(ngModel)]="element['Estimated SP']"
        />
        <span *ngIf="!element.isEditMode">{{ element["Estimated SP"] }}</span>
      </td>
    </ng-container>

    <!-- Actual SP Column -->
    <ng-container matColumnDef="Actual SP">
      <th mat-header-cell *matHeaderCellDef>Actual SP</th>
      <td mat-cell *matCellDef="let element">
        <input
          *ngIf="element.isEditMode"
          type="number"
          [(ngModel)]="element['Actual SP']"
        />
        <span *ngIf="!element.isEditMode">{{ element["Actual SP"] }}</span>
      </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let element">
        <button
          *ngIf="!element.isEditMode"
          mat-button
          (click)="editRow(element)"
        >
          Edit
        </button>
        <button
          *ngIf="element.isEditMode"
          mat-button
          (click)="saveRow(element)"
        >
          Save
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</div>
